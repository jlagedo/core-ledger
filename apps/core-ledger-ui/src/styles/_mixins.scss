// ============================================================
// MIXINS â€” CSS Variable Generation
//
// Mixins for generating theme-aware CSS custom properties.
// ============================================================

@use "sass:map";
@use "sass:list";
@use "variables" as *;
@use "theme-tokens" as *;
@use "alert-tokens" as *;

/// Generate all theme CSS variables for a given mode
/// @param {String} $mode - 'light' or 'dark'
@mixin generate-theme-vars($mode) {
  $t: map.get($theme-tokens, $mode);
  $prefix: if(sass($mode == light): light; else: dark);

  // --- Core ---
  --bs-body-bg: #{map.get($t, body-bg)};
  --bs-body-color: #{map.get($t, body-color)};
  --bs-emphasis-color: #{map.get($t, emphasis)};

  // --- Links ---
  --bs-link-color: #{map.get($t, link)};
  --bs-link-hover-color: #{map.get($t, link-hover)};
  --link-visited-color: #{map.get($t, link-visited)};

  // --- Borders ---
  --bs-border-color: #{map.get($t, border)};
  --bs-border-color-translucent: #{map.get($t, border-translucent)};

  // --- Shadows ---
  --bs-box-shadow-sm: #{map.get($t, shadow-sm)};
  --bs-box-shadow: #{map.get($t, shadow-md)};
  --bs-box-shadow-lg: #{map.get($t, shadow-lg)};

  // --- Focus ---
  --bs-focus-ring-color: #{map.get($t, focus-ring)};
  --btn-focus-outline: #{map.get($t, focus-outline)};
  --focus-ring-offset: #{map.get($t, focus-ring-offset)};

  // --- Validation ---
  --bs-form-valid-color: #{map.get($t, valid)};
  --bs-form-valid-border-color: #{map.get($t, valid-border)};
  --bs-form-invalid-color: #{map.get($t, invalid)};
  --bs-form-invalid-border-color: #{map.get($t, invalid-border)};

  // --- Disabled ---
  --disabled-bg: #{map.get($t, disabled-bg)};
  --disabled-color: #{map.get($t, disabled-color)};
  --disabled-border: #{map.get($t, disabled-border)};
  --disabled-opacity: #{map.get($t, disabled-opacity)};

  // --- Card ---
  --card-bg: #{map.get($t, card-bg)};
  --card-border-color: #{map.get($t, card-border)};
  --card-header-bg: #{map.get($t, card-header)};
  --card-shadow: #{map.get($t, shadow-sm)};
  --card-hover-shadow: #{map.get($t, shadow-lg)};

  // --- Glass ---
  --glass-bg: #{map.get($t, glass-bg)};
  --glass-border: #{map.get($t, glass-border)};
  --glass-shadow: #{map.get($t, glass-shadow)};

  // --- Input ---
  --input-bg: #{map.get($t, input-bg)};
  --input-border: #{map.get($t, input-border)};
  --input-focus-border: #{map.get($t, input-focus)};
  --input-focus-shadow: #{map.get($t, input-focus-shadow)};
  --input-placeholder-color: #{map.get($t, input-placeholder)};
  --input-error-bg: #{map.get($t, input-error-bg)};

  // --- Table ---
  --table-bg: #{map.get($t, table-bg)};
  --table-header-bg: #{map.get($t, table-header-bg)};
  --table-header-color: #{map.get($t, table-header-color)};
  --table-striped-bg: #{map.get($t, table-striped)};
  --table-hover-bg: #{map.get($t, table-hover)};
  --table-active-bg: #{map.get($t, table-active-bg)};
  --table-active-color: #{map.get($t, table-active-color)};
  --table-active-border: #{map.get($t, table-active-border)};
  --table-border-color: #{map.get($t, table-border)};
  --table-cell-color: #{map.get($t, table-cell)};
  --table-action-color: #{map.get($t, table-action)};
  --table-action-hover-color: #{map.get($t, table-action-hover)};

  // --- Button ---
  --btn-primary-hover-bg: #{map.get($t, btn-primary-hover)};
  --btn-primary-hover-border: #{map.get($t, btn-primary-hover)};
  --btn-secondary-bg: #{map.get($t, btn-secondary-bg)};
  --btn-secondary-border: #{map.get($t, btn-secondary-bg)};
  --btn-secondary-color: #{map.get($t, btn-secondary-color)};
  --btn-secondary-hover-bg: #{map.get($t, btn-secondary-hover)};

  // --- Navigation ---
  --nav-link-active-color: #{map.get($t, nav-active)};
  --nav-link-underline: #{map.get($t, nav-underline)};

  // --- Scrollbar ---
  --scrollbar-track: #{map.get($t, scrollbar-track)};
  --scrollbar-thumb: #{map.get($t, scrollbar-thumb)};

  // --- Selection ---
  --selection-bg: #{map.get($t, selection)};

  // --- Dropdown ---
  --dropdown-bg: #{map.get($t, dropdown-bg)};
  --dropdown-border: #{map.get($t, dropdown-border)};

  // --- Sidenav ---
  --sidenav-bg: #{map.get($t, sidenav-bg)};
  --sidenav-color: #{map.get($t, sidenav-color)};
  --sidenav-gradient: #{map.get($t, sidenav-gradient)};
  --sidenav-link-hover-bg: #{map.get($t, sidenav-hover)};
  --sidenav-active-bg: #{map.get($t, sidenav-active-bg)};
  --sidenav-active-border: #{map.get($t, sidenav-active-border)};
  --sidenav-divider: #{map.get($t, sidenav-divider)};
  --sidenav-border-color: #{map.get($t, border)};

  // --- Terminal Glow ---
  --terminal-glow: #{map.get($t, terminal-glow)};
  --terminal-glow-muted: #{map.get($t, terminal-glow-muted)};
  --terminal-glow-subtle: #{map.get($t, terminal-glow-subtle)};
  --terminal-glow-bg: #{map.get($t, terminal-glow-bg)};

  // --- Amber Opacity Scale ---
  --amber-2: #{map.get($t, amber-4)}; // Alias for consistency
  --amber-4: #{map.get($t, amber-4)};
  --amber-5: #{map.get($t, amber-5)};
  --amber-6: #{map.get($t, amber-6)};
  --amber-8: #{map.get($t, amber-8)};
  --amber-10: #{map.get($t, amber-10)};
  --amber-12: #{map.get($t, amber-12)};
  --amber-15: #{map.get($t, amber-15)};
  --amber-18: #{map.get($t, amber-18)};
  --amber-20: #{map.get($t, amber-20)};
  --amber-25: #{map.get($t, amber-25)};
  --amber-30: #{map.get($t, amber-30)};
  --amber-40: #{map.get($t, amber-40)};
  --amber-50: #{map.get($t, amber-50)};
  --amber-60: #{map.get($t, amber-60)};
  --amber-70: #{map.get($t, amber-70)};

  // --- Teal Opacity Scale ---
  --teal-2: #{map.get($t, teal-2)};
  --teal-4: #{map.get($t, teal-4)};
  --teal-5: #{map.get($t, teal-5)};
  --teal-6: #{map.get($t, teal-6)};
  --teal-8: #{map.get($t, teal-8)};
  --teal-10: #{map.get($t, teal-10)};
  --teal-12: #{map.get($t, teal-12)};
  --teal-15: #{map.get($t, teal-15)};
  --teal-18: #{map.get($t, teal-18)};
  --teal-20: #{map.get($t, teal-20)};
  --teal-25: #{map.get($t, teal-25)};
  --teal-30: #{map.get($t, teal-30)};
  --teal-35: #{map.get($t, teal-35)};

  // --- Coral Opacity Scale ---
  --coral-2: #{map.get($t, coral-2)};
  --coral-5: #{map.get($t, coral-5)};
  --coral-6: #{map.get($t, coral-6)};
  --coral-8: #{map.get($t, coral-8)};
  --coral-10: #{map.get($t, coral-10)};
  --coral-15: #{map.get($t, coral-15)};
  --coral-20: #{map.get($t, coral-20)};
  --coral-30: #{map.get($t, coral-30)};
  --coral-40: #{map.get($t, coral-40)};
  --coral-50: #{map.get($t, coral-50)};

  // --- Blue Opacity Scale ---
  --blue-4: #{map.get($t, blue-4)};
  --blue-6: #{map.get($t, blue-6)};
  --blue-15: #{map.get($t, blue-15)};
  --blue-20: #{map.get($t, blue-20)};

  // --- Indigo Opacity Scale ---
  --indigo-2: #{map.get($t, indigo-2)};
  --indigo-3: #{map.get($t, indigo-3)};
  --indigo-4: #{map.get($t, indigo-4)};
  --indigo-5: #{map.get($t, indigo-5)};
  --indigo-8: #{map.get($t, indigo-8)};
  --indigo-10: #{map.get($t, indigo-10)};
  --indigo-15: #{map.get($t, indigo-15)};
  --indigo-20: #{map.get($t, indigo-20)};
  --indigo-25: #{map.get($t, indigo-25)};
  --indigo-30: #{map.get($t, indigo-30)};

  // --- Accent Colors ---
  --accent-teal: #{if(sass($mode == dark): $accent-teal; else: $daylight-teal)};
  --accent-coral: #{if(sass($mode == dark): $accent-coral; else: $daylight-coral)};
  --accent-amber: #{if(sass($mode == dark): $accent-amber; else: $daylight-amber)};
  --accent-indigo: #{if(sass($mode == dark): $accent-indigo; else: $daylight-indigo)};
  --accent-blue: #{if(sass($mode == dark): $accent-blue; else: $brand-blue-500)};

  // --- Status Indicators (Ticker/Alerts) ---
  --status-safe: #{map.get($t, status-safe)};
  --status-safe-muted: #{map.get($t, status-safe-muted)};
  --status-warning: #{map.get($t, status-warning)};
  --status-warning-glow: #{map.get($t, status-warning-glow)};
  --status-critical: #{map.get($t, status-critical)};
  --status-critical-glow: #{map.get($t, status-critical-glow)};
  --status-expired: #{map.get($t, status-expired)};

  // --- Semantic Status Colors (Data Displays) ---
  --status-positive: #{map.get($t, status-positive)};
  --status-positive-bg: #{map.get($t, status-positive-bg)};
  --status-positive-border: #{map.get($t, status-positive-border)};
  --status-positive-muted: #{map.get($t, status-positive-muted)};
  --status-negative: #{map.get($t, status-negative)};
  --status-negative-bg: #{map.get($t, status-negative-bg)};
  --status-negative-border: #{map.get($t, status-negative-border)};
  --status-info: #{map.get($t, status-info)};
  --status-info-bg: #{map.get($t, status-info-bg)};
  --status-info-border: #{map.get($t, status-info-border)};
  --status-pending: #{map.get($t, status-pending)};
  --status-pending-bg: #{map.get($t, status-pending-bg)};
  --status-pending-border: #{map.get($t, status-pending-border)};
  --status-neutral: #{map.get($t, status-neutral)};
  --status-neutral-bg: #{map.get($t, status-neutral-bg)};
  --status-neutral-border: #{map.get($t, status-neutral-border)};

  // --- Surface Elevation ---
  --surface-base: #{map.get($t, surface-base)};
  --surface-elevated: #{map.get($t, surface-elevated)};
  --surface-subtle: #{map.get($t, surface-subtle)};
  --surface-muted: #{map.get($t, surface-muted)};

  // --- Alerts ---
  @each $type, $config in $alert-tokens {
    --alert-#{$type}-bg: #{map.get($config, #{$prefix}-bg)};
    --alert-#{$type}-border: #{map.get($config, #{$prefix}-border)};
    --alert-#{$type}-color: #{map.get($config, #{$prefix}-color)};
    --alert-#{$type}-accent: #{map.get($config, #{$prefix}-accent)};

    @if map.has-key($config, #{$prefix}-shadow) {
      --alert-#{$type}-text-shadow: #{map.get($config, #{$prefix}-shadow)};
    }
  }

  // --- Badges ---
  @each $type, $config in $badge-tokens {
    $values: map.get($config, $prefix);
    --badge-#{$type}-bg: #{list.nth($values, 1)};
    --badge-#{$type}-color: #{list.nth($values, 2)};
  }
}

// ============================================================
// WIZARD ANIMATIONS
// Shared animations for wizard step components
// ============================================================

/// Step enter animation - fade in with slight upward movement
/// Usage: @include step-enter-animation('.my-step');
@mixin step-enter-animation($selector) {
  #{$selector} {
    animation: step-enter 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
}

@keyframes step-enter {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/// Feedback enter animation - for validation messages
/// Usage: @include feedback-enter-animation;
@mixin feedback-enter-animation {
  animation: feedback-enter 0.2s ease;
}

@keyframes feedback-enter {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/// Conditional field slide animation
/// Usage: .my-conditional-field { @include field-slide-animation; }
@mixin field-slide-animation {
  animation: field-slide-down 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes field-slide-down {
  from {
    opacity: 0;
    transform: translateY(-8px);
    max-height: 0;
  }
  to {
    opacity: 1;
    transform: translateY(0);
    max-height: 500px;
  }
}

/// Pulse warning animation - for critical indicators
/// Usage: .warning-indicator { @include pulse-warning; }
@mixin pulse-warning {
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

/// Alert enter animation
/// Usage: .my-alert { @include alert-enter-animation; }
@mixin alert-enter-animation {
  animation: alert-enter 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes alert-enter {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/// Dropdown enter animation
/// Usage: .dropdown { @include dropdown-enter-animation; }
@mixin dropdown-enter-animation {
  animation: dropdown-enter 0.2s ease;
}

@keyframes dropdown-enter {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/// Reduced motion wrapper
/// Usage: @include reduced-motion { .element { animation: none; } }
@mixin reduced-motion {
  @media (prefers-reduced-motion: reduce) {
    @content;
  }
}

// ============================================================
// WIZARD CARD COMPONENTS
// Reusable patterns for wizard step cards and lists
// ============================================================

/// Card list header - header bar for card list sections
/// @param {String} $color-name - Color scale name (amber, teal, indigo, coral)
/// Usage: .my-header { @include card-list-header(amber); }
@mixin card-list-header($color-name: amber) {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.625rem 0.875rem;
  background: var(--#{$color-name}-2);
  border: 1px solid var(--table-border-color);
  border-radius: 2px;

  &__info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  &__count {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--bs-body-color);
  }

  &__warning {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--accent-coral);
    @include pulse-warning;
  }
}

/// Empty state placeholder - centered placeholder for empty lists
/// @param {String} $color-name - Color scale name (amber, teal, indigo, coral)
/// Usage: .my-empty { @include empty-state-placeholder(teal); }
@mixin empty-state-placeholder($color-name: amber) {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 2rem;
  background: var(--#{$color-name}-2);
  border: 1px dashed var(--table-border-color);
  border-radius: 2px;
  color: var(--bs-secondary-color);

  &__icon {
    font-size: 2rem;
    opacity: 0.5;
  }

  &__text {
    font-size: 0.8125rem;
    margin: 0;
  }
}

/// Wizard conditional section - for expandable content areas
/// @param {String} $color-name - Color scale name (amber, teal, indigo, coral)
/// Usage: .my-section { @include wizard-section(amber); }
@mixin wizard-section($color-name: amber) {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem;
  margin-top: 0.5rem;
  background: var(--#{$color-name}-2);
  border: 1px dashed var(--#{$color-name}-20);
  border-radius: 2px;
  @include field-slide-animation;

  .form-section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    padding-bottom: 0;
    border-bottom: none;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--accent-#{$color-name});

    &::before {
      display: none;
    }

    i {
      font-size: 0.75rem;
    }
  }
}

/// Wizard list card - base card for list items
/// @param {String} $color-name - Color scale name (amber, teal, indigo, coral)
/// Usage: .my-card { @include wizard-list-card(teal); }
@mixin wizard-list-card($color-name: amber) {
  background: var(--bs-secondary-bg);
  border: 1px solid var(--table-border-color);
  border-radius: 2px;
  overflow: hidden;
  transition: all 0.2s ease;

  &:hover {
    border-color: var(--#{$color-name}-30);
  }

  &__header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: var(--#{$color-name}-2);
    border-bottom: 1px solid var(--table-border-color);
  }

  &__number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    font-size: 0.625rem;
    font-weight: 700;
    background: var(--#{$color-name}-10);
    border-radius: 2px;
    color: var(--accent-#{$color-name});
  }

  &__title {
    flex: 1;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--bs-body-color);
  }

  &__remove {
    padding: 0.25rem;
    color: var(--accent-coral);
    opacity: 0.7;
    transition: all 0.2s ease;

    &:hover {
      opacity: 1;
      background: var(--coral-10);
    }
  }

  &__locked {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.25rem;
    font-size: 0.75rem;
    color: var(--bs-secondary-color);
    opacity: 0.5;
  }

  &__body {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
}
